{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/goals_page.css' %}">

<div class="goals-container">

  <!-- Header -->
  <div class="header-row">
    <div>
      <h2 class="title">Your Goals</h2>
      <p class="subtitle">Track and achieve your goals</p>
    </div>
    <button onclick="openCreateGoalModal()" class="btn-primary">Create Goal</button>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <form method="GET" class="filters-grid">

      <input type="text" name="search" placeholder="Search goals..." value="{{ search }}" class="input"/>

      <!-- Category -->
      <select name="category" class="input">
        {% for c in categories %}
        <option value="{{ c }}" {% if c == category %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>

      <!-- Status -->
      <select name="status" class="input">
        {% for s in statuses %}
        <option value="{{ s }}" {% if s == status %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>

      <button class="btn-secondary">Apply</button>
    </form>
  </div>

  <!-- Goals Grid -->
  {% if goals %}
  <div class="goals-grid">
    {% for goal in goals %}
    <div class="goal-card">

      <div class="goal-header">
        <h3 class="goal-title">{{ goal.title }}</h3>
        <a href="{% url 'delete_goal' goal.id %}" class="delete-btn">Delete</a>
      </div>

      <p class="goal-desc">{{ goal.description }}</p>
      <p class="goal-cat">{{ goal.category }}</p>

      <div class="progress-label">
        <span>Progress</span>
        <span class="status-tag">{{ goal.status }}</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" style="width: {{ goal.progress }}%;"></div>
      </div>

      <div class="progress-footer">
        <span>{{ goal.progress }}% complete</span>
        <button class="btn-small" onclick="openUpdateModal({{ goal.id }}, {{ goal.progress }})">Update</button>
      </div>

      <p class="date-sm">Created: {{ goal.created_at|date:"M j, Y" }}</p>

      {% if goal.target_date %} 
        <p class="date-sm">Target: {{ goal.target_date|date:"M j, Y" }}</p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="no-goals">
      <p>No goals found.</p>
    </div>
  {% endif %}
</div>

<!-- ‚úÖ Achievement Toast Notification -->
{% if messages %}
  <div id="toast-container">
    {% for message in messages %}
      <div class="toast toast-success">
        <span class="toast-icon">üèÜ</span>
        <span class="toast-text">{{ message }}</span>
      </div>
    {% endfor %}
  </div>
{% endif %}

{% include "goals_update_modal.html" %}
{% include "goals_create_modal.html" %}
{% endblock %}

{% block scripts %}
<script>
  setTimeout(() => {
    document.querySelectorAll(".toast").forEach(t => t.remove());
  }, 4200);
</script>
<script src="{% static 'js/goals_modal.js' %}" defer></script>
{% endblock %}