{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

<div class="profile-container">
  <div class="header">
    <div>
      <h2>Profile</h2>
      <p class="subtitle">Manage your account settings and preferences</p>
    </div>
    <button id="editBtn" class="outline-btn">Edit Profile</button>
  </div>

  <div class="profile-grid">
    <!-- Left Column: Profile Info -->
    <div class="card profile-card">
      <div class="card-header">
        <h3>Personal Information</h3>
        <p>Your personal details and bio</p>
      </div>

      <div class="card-body">
        <div class="avatar-section">
          {% if profile.avatar %}
          <img src="{{ profile.avatar.url }}" alt="Avatar" class="avatar" />
          {% else %}
          <div class="avatar-placeholder">
            {{ user.username|first|upper }}
          </div>
          {% endif %}
        </div>

        <!-- View Mode -->
        <div id="viewMode" class="info-section">
          <h3 class="username">{{ user.username }}</h3>
          <p class="user-info"><strong>Full Name:</strong> {{ user.first_name }} {{ user.last_name }}</p>
          <p class="user-info"><strong>Email:</strong> {{ user.email }}</p>
          <p class="user-info"><strong>Location:</strong> {{ profile.location|default:"Not specified" }}</p>
          <p class="user-info"><strong>Bio:</strong> {{ profile.bio|default:"No bio yet." }}</p>
        </div>

        <!-- Edit Mode -->
        <form id="editMode" method="POST" class="info-section edit-form" style="display:none;">
          {% csrf_token %}
          <div class="form-group">
            <label>Username</label>
            <input type="text" name="username" value="{{ user.username }}" required />
          </div>

          <div class="form-row">
            <div class="form-group half">
              <label>First Name</label>
              <input type="text" name="first_name" value="{{ user.first_name }}" />
            </div>

            <div class="form-group half">
              <label>Last Name</label>
              <input type="text" name="last_name" value="{{ user.last_name }}" />
            </div>
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" name="email" value="{{ user.email }}" />
          </div>

          <div class="form-group">
            <label>Location</label>
            <input type="text" name="location" value="{{ profile.location|default:'' }}" />
          </div>

          <div class="form-group">
            <label>Bio</label>
            <textarea name="bio" rows="4">{{ profile.bio|default:'' }}</textarea>
          </div>

          <div class="button-row">
            <button type="submit" class="save-btn">Save Changes</button>
            <button type="button" id="cancelBtn" class="outline-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Right Column: Stats & Achievements -->
    <div class="side-column">
      <div class="card small-card">
        <div class="card-header">
          <h3>Your Stats</h3>
        </div>
        <div class="card-body">
          <ul class="stats-list">
            {% for label, value in stats.items %}
            <li><span>{{ label }}</span><strong>{{ value }}</strong></li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div class="card small-card">
        <div class="card-header">
          <h3>Achievements</h3>
          <p>Your earned badges and milestones</p>
        </div>
        <div class="card-body">
          <div class="badges">
            {% for achievement in achievements %}
            <span class="badge">{{ achievement }}</span>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const editBtn = document.getElementById("editBtn");
  const cancelBtn = document.getElementById("cancelBtn");
  const viewMode = document.getElementById("viewMode");
  const editMode = document.getElementById("editMode");

  editBtn.addEventListener("click", () => {
    viewMode.style.display = "none";
    editMode.style.display = "block";
    editBtn.style.display = "none";
  });

  cancelBtn.addEventListener("click", () => {
    viewMode.style.display = "block";
    editMode.style.display = "none";
    editBtn.style.display = "inline-block";
  });
</script>
{% endblock %}
